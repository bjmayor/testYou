<?phpdefined('BASEPATH') OR exit('No direct script access allowed');/** *  **/class Result extends Admin_Controller{        function __construct()    {        parent::__construct();        $this->load->model('result_model');        $this->load->model('question_model');    }    public function index($question_id=-1, $result_id=-1)    {        $this->data['question'] = $this->question_model->get_question(array('id'=>$question_id));         if($result_id>0)        {            $this->data['result'] = $this->result_model->get_result(array('id'=>$result_id));        }        /* Load Template */        $this->template->admin_render('admin/result/index', $this->data);    }    public function create()    {        $ret = true;        $result_id;        $result = $this->input->post('result');        $last_result = $this->result_model->get_result(array("question_id"=>$result['question_id'],"sort_direction"=>"desc","sort_by"=>"label","limit"=>1));        if($last_result!=false)        {            $result['label'] = $last_result[0]['label']+1;        }        else        {            $result['label'] = 1;        }        if(isset($result['id']) && $result['id']>0)        {            $result_id = $result['id'];            $model = $this->result_model->get_result(array('id'=>$result_id));            if($this->is_diff($model,$result))            {                $ret = $this->result_model->update_result($result);            }        }        else        {            $ret =  $result_id = $this->result_model->insert_result($result);        }        if($ret)        {            Response::build(0,'ok',$result_id)->show();        }        else        {            Response::build(-1,"create result fail")->show();        }    //    $this->output->enable_profiler(TRUE);    }    public function del()    {        $id = $this->input->post("id");        //$result = $this->result_model->get_result(array("id"=>$id));        $ret = $this->result_model->delete_result(array("id"=>$id));        if($ret)        {            Response::build(0,'ok',$id)->show();        }        else        {            Response::build(-1,"delete result fail")->show();        }    }}?>